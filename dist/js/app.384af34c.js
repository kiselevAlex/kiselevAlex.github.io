(function(t){function e(e){for(var r,s,i=e[0],c=e[1],u=e[2],d=0,p=[];d<i.length;d++)s=i[d],Object.prototype.hasOwnProperty.call(a,s)&&a[s]&&p.push(a[s][0]),a[s]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(t[r]=c[r]);l&&l(e);while(p.length)p.shift()();return o.push.apply(o,u||[]),n()}function n(){for(var t,e=0;e<o.length;e++){for(var n=o[e],r=!0,i=1;i<n.length;i++){var c=n[i];0!==a[c]&&(r=!1)}r&&(o.splice(e--,1),t=s(s.s=n[0]))}return t}var r={},a={app:0},o=[];function s(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=r,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)s.d(n,r,function(e){return t[e]}.bind(null,r));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],c=i.push.bind(i);i.push=e,i=i.slice();for(var u=0;u<i.length;u++)e(i[u]);var l=c;o.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"01b4":function(t,e,n){},"034f":function(t,e,n){"use strict";var r=n("85ec"),a=n.n(r);a.a},1573:function(t,e,n){"use strict";var r=n("01b4"),a=n.n(r);a.a},"1e36":function(t,e,n){"use strict";var r=n("e29d"),a=n.n(r);a.a},2110:function(t,e,n){t.exports=n.p+"img/basket.0d14a209.svg"},"4a51":function(t,e,n){},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("2b0e"),a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[t.loading?n("div",[t._v("Загрузка...")]):n("Catalog",{attrs:{categoriesMap:t.categoriesMap,goodsMap:t.goodsMap,onBasket:t.updateBasket}}),n("Basket",{attrs:{items:t.basket,goodsMap:t.goodsMap,onBasket:t.updateBasket}})],1)},o=[],s=(n("d3b7"),n("3ca3"),n("ddb0"),n("5530")),i=(n("96cf"),n("1da1")),c=n("2f62"),u=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"categories"},t._l(t.categoriesMap,(function(e){return n("Category",{key:e.id,staticClass:"categories-item",attrs:{category:e},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.goodIds;return t._l(r,(function(e){return n("Goods",{key:e,attrs:{goods:t.goodsMap[e],onBasket:t.onBasket}})}))}}],null,!0)})})),1)},l=[],d=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("Card",{staticClass:"category",scopedSlots:t._u([{key:"title",fn:function(){return[t._v(t._s(t.category.name))]},proxy:!0},{key:"content",fn:function(){return[t._t("default",null,{goodIds:t.category.goodIds})]},proxy:!0}],null,!0)})},p=[],f=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"card"},[n("div",{staticClass:"card-title",style:t.styles},[t._t("title")],2),n("div",{staticClass:"card-content"},[t._t("content")],2)])},v=[],m={props:{color:{type:String,default:"#f8754b"}},computed:{styles:function(){return{backgroundColor:this.color}}}},b=m,h=(n("bab7"),n("2877")),g=Object(h["a"])(b,f,v,!1,null,null,null),y=g.exports,k={components:{Card:y},props:{category:{type:Object,required:!0}}},j=k,O=(n("be88"),Object(h["a"])(j,d,p,!1,null,null,null)),_=O.exports,w=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"goods"},[n("div",{staticClass:"goods-title"},[t._v(t._s(t.goods.name)+" ("+t._s(t.goods.limit)+")")]),n("div",{staticClass:"goods-price"},[n("Price",{attrs:{price:t.goods.price}})],1),n("button",{staticClass:"goods-button",on:{click:function(e){return t.onBasket(t.goods)}}},[n("img",{attrs:{src:t.$options.icons.basket}})])])},x=[],M=n("2110"),C=n.n(M),R=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("span",{class:t.className},[t._v(t._s(t.price))])},B=[],G=(n("a9e3"),{props:{price:{type:Number,required:!0}},data:function(){return{oldVal:null}},watch:{price:function(t,e){this.oldVal=e}},computed:{className:function(){if(null!==this.oldVal)return this.oldVal>this.price?"green":this.oldVal<this.price?"red":""}}}),P=G,q=(n("5c20"),Object(h["a"])(P,R,B,!1,null,"89fff1da",null)),N=q.exports,E={components:{Price:N},icons:{basket:C.a},props:{goods:{type:Object,required:!0},onBasket:{type:Function,required:!0}}},$=E,S=(n("ad3b"),Object(h["a"])($,w,x,!1,null,null,null)),V=S.exports,I={components:{Category:_,Goods:V},props:{categoriesMap:{type:Object,required:!0},goodsMap:{type:Object,required:!0},onBasket:{type:Function,required:!0}}},T=I,F=(n("7cd2"),Object(h["a"])(T,u,l,!1,null,null,null)),D=F.exports,J=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("Card",{staticClass:"basket",attrs:{color:"#f3501b"},scopedSlots:t._u([{key:"title",fn:function(){return[t._v("Корзина")]},proxy:!0},{key:"content",fn:function(){return[t.isEmpty?n("div",[t._v("Корзина пуста")]):[n("Row",{scopedSlots:t._u([{key:"name",fn:function(){return[t._v("Название")]},proxy:!0},{key:"count",fn:function(){return[t._v("Количество")]},proxy:!0},{key:"price",fn:function(){return[t._v("Цена за шт.")]},proxy:!0}])}),t._l(t.items,(function(e,r){return n("Item",{key:r,attrs:{goods:t.goodsMap[r],count:e,onBasket:t.onBasket}})})),n("div",{staticClass:"basket-total"},[t._v(" Общая стоимость: "),n("span",[t._v(t._s(t.total))])])]]},proxy:!0}])})},W=[],z=(n("13d5"),n("b64b"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("Row",{scopedSlots:t._u([{key:"name",fn:function(){return[t._v(t._s(t.goods.name))]},proxy:!0},{key:"count",fn:function(){return[n("div",[n("input",{ref:"count",domProps:{value:t.count},on:{input:t.onInput,change:t.onChange}}),t._v(" шт. "),n("div",{staticClass:"max"},[t._v("максимум: "+t._s(t.goods.limit))])])]},proxy:!0},{key:"price",fn:function(){return[n("Price",{attrs:{price:t.goods.price}}),t._v("/ шт. ")]},proxy:!0},{key:"actions",fn:function(){return[n("button",{staticClass:"delete",on:{click:t.deleteFromBasket}},[t._v("Удалить")])]},proxy:!0}])})}),A=[],H=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"row"},[n("div",{staticClass:"row-name"},[t._t("name")],2),n("div",{staticClass:"row-count"},[t._t("count")],2),n("div",{staticClass:"row-price"},[t._t("price")],2),n("div",{staticClass:"row-actions"},[t._t("actions")],2)])},K=[],L={},Q=L,U=(n("1573"),Object(h["a"])(Q,H,K,!1,null,null,null)),X=U.exports,Y={components:{Row:X,Price:N},props:{goods:{type:Object,required:!0},count:{type:Number,required:!0},onBasket:{type:Function,required:!0}},methods:{deleteFromBasket:function(){this.onBasket({id:this.goods.id,count:0})},onInput:function(t){var e=t.target.value;/[^\d]/.test(e)?(t.preventDefault(),this.$refs.count.value=void 0!==this.lastValid?this.lastValid:this.count):this.lastValid=e},onChange:function(t){var e=t.target.value;this.onBasket({id:this.goods.id,count:+e}),this.$refs.count.value=this.count,this.lastValid=this.count}}},Z=Y,tt=(n("68bc"),Object(h["a"])(Z,z,A,!1,null,null,null)),et=tt.exports,nt=function(t){return Math.ceil(100*t)/100},rt=function(t,e){return Math.random()*(e-t)+t},at=n("13ea"),ot=n.n(at),st={components:{Card:y,Item:et,Row:X},props:{items:{type:Object,required:!0},goodsMap:{type:Object,required:!0},onBasket:{type:Function,required:!0}},computed:{isEmpty:function(){return ot()(this.items)},total:function(){var t=this;return nt(Object.keys(this.items).reduce((function(e,n){return e+t.items[n]*t.goodsMap[n].price}),0))}}},it=st,ct=(n("1e36"),Object(h["a"])(it,J,W,!1,null,null,null)),ut=ct.exports,lt={components:{Catalog:D,Basket:ut},data:function(){return{loading:!1}},created:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,t.loading=!0,e.next=4,t.init();case 4:e.next=9;break;case 6:e.prev=6,e.t0=e["catch"](0),console.error(e.t0);case 9:return e.prev=9,t.loading=!1,e.finish(9);case 12:case"end":return e.stop()}}),e,null,[[0,6,9,12]])})))()},beforeDestroy:function(){this.timout&&clearTimeout(this.timout)},methods:Object(s["a"])({init:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([t.loadGoods(),t.loadNames(),t.loadRate()]);case 2:t.interval();case 3:case"end":return e.stop()}}),e)})))()},interval:function(){var t=this;this.timout=setTimeout(Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.all([t.loadGoods(),t.loadRate()]);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e["catch"](0),console.error(e.t0);case 8:return e.prev=8,t.interval(),e.finish(8);case 11:case"end":return e.stop()}}),e,null,[[0,5,8,11]])}))),15e3)}},Object(c["b"])({loadGoods:"loadGoods",loadNames:"loadNames",loadRate:"loadRate",updateBasket:"updateBasket"})),computed:Object(s["a"])(Object(s["a"])({},Object(c["c"])(["categoriesMap","goodsMap"])),Object(c["d"])(["basket"]))},dt=lt,pt=(n("034f"),Object(h["a"])(dt,a,o,!1,null,null,null)),ft=pt.exports,vt=(n("99af"),n("2909")),mt=n("ade3"),bt=n("3eea"),ht=n.n(bt),gt=n("d4ec"),yt=n("bee2"),kt=n("f9c7"),jt=(n("10d1"),n("5364")),Ot=n("9bd1"),_t=new WeakMap,wt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.headers;Object(gt["a"])(this,t),_t.set(this,{writable:!0,value:null}),Object(Ot["a"])(this,_t,{headers:n})}return Object(yt["a"])(t,[{key:"request",value:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e,n){var r,a,o,i,c,u;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=n.method,a=n.body,o=n.headers,i=Object(jt["a"])(this,_t),c=i.headers,t.next=4,fetch(e,{method:r,body:a,headers:Object(s["a"])(Object(s["a"])({},c),o)});case 4:if(u=t.sent,u.ok){t.next=7;break}throw Error(u.statusText);case 7:return t.abrupt("return",u.json());case 8:case"end":return t.stop()}}),t,this)})));function e(e,n){return t.apply(this,arguments)}return e}()},{key:"get",value:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",this.request(e,{method:"GET"}));case 1:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()}]),t}(),xt=wt,Mt=function(){function t(){Object(gt["a"])(this,t)}return Object(yt["a"])(t,null,[{key:"getGoods",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(kt["a"])(this,t,Ct).get("/data.json"));case 1:case"end":return e.stop()}}),e,this)})));function n(){return e.apply(this,arguments)}return n}()},{key:"getNames",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(kt["a"])(this,t,Ct).get("/names.json"));case 1:case"end":return e.stop()}}),e,this)})));function n(){return e.apply(this,arguments)}return n}()}]),t}(),Ct={writable:!0,value:new xt},Rt=Mt;r["a"].use(c["a"]);var Bt=new c["a"].Store({state:{rate:0,goods:[],namesMap:{},basket:{}},mutations:{setRate:function(t,e){t.rate=e},setGoods:function(t,e){t.goods=e},setNamesMap:function(t,e){t.namesMap=e},setBasket:function(t,e){var n=e.id,r=e.count,a=void 0===r?1:r,o=t.basket;t.basket=a<=0?ht()(o,[n]):Object(s["a"])(Object(s["a"])({},o),{},Object(mt["a"])({},n,a))},fromBasket:function(t,e){t.namesMap=e}},actions:{init:function(t){var e=t.dispatch;return Promise.all([e("loadGoods"),e("loadNames")])},loadGoods:function(t){return Object(i["a"])(regeneratorRuntime.mark((function e(){var n,r,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.commit,e.next=3,Rt.getGoods();case 3:r=e.sent,a=r.Value.Goods,n("setGoods",a);case 6:case"end":return e.stop()}}),e)})))()},loadNames:function(t){return Object(i["a"])(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.commit,e.t0=n,e.next=4,Rt.getNames();case 4:e.t1=e.sent,(0,e.t0)("setNamesMap",e.t1);case 6:case"end":return e.stop()}}),e)})))()},updateBasket:function(t,e){var n,r=t.commit,a=t.getters,o=e.id,s=e.count,i=void 0===s?1:s,c=null===(n=a["goodsMap"][o])||void 0===n?void 0:n.limit;r("setBasket",{id:o,count:i>c?c:i})},loadRate:function(t){return Object(i["a"])(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:n=t.commit,n("setRate",nt(rt(20,80)));case 2:case"end":return e.stop()}}),e)})))()}},getters:{categoriesMap:function(t){var e=t.goods,n=t.namesMap;return e.reduce((function(t,e){var r,a,o=e.G,i=e.T;return Object(s["a"])(Object(s["a"])({},t),{},Object(mt["a"])({},o,{id:o,name:null===(r=n[o])||void 0===r?void 0:r.G,goodIds:[].concat(Object(vt["a"])((null===(a=t[o])||void 0===a?void 0:a.goodIds)||[]),[i])}))}),{})},goodsMap:function(t){var e=t.goods,n=t.namesMap,r=t.rate;return e.reduce((function(t,e){var a,o,i,c=e.T,u=e.P,l=e.C,d=e.G;return Object(s["a"])(Object(s["a"])({},t),{},Object(mt["a"])({},c,{id:c,name:(null===(a=n[d])||void 0===a?void 0:a.B)&&(null===(o=n[d])||void 0===o||null===(i=o.B[c])||void 0===i?void 0:i.N),limit:u,price:nt(l*r)}))}),{})}}});r["a"].config.productionTip=!1,new r["a"]({store:Bt,render:function(t){return t(ft)}}).$mount("#app")},"5c20":function(t,e,n){"use strict";var r=n("a3ce"),a=n.n(r);a.a},"5e3a":function(t,e,n){},"68bc":function(t,e,n){"use strict";var r=n("c0bd"),a=n.n(r);a.a},7211:function(t,e,n){},"7cd2":function(t,e,n){"use strict";var r=n("7211"),a=n.n(r);a.a},"85ec":function(t,e,n){},a23b:function(t,e,n){},a3ce:function(t,e,n){},ad3b:function(t,e,n){"use strict";var r=n("4a51"),a=n.n(r);a.a},bab7:function(t,e,n){"use strict";var r=n("5e3a"),a=n.n(r);a.a},be88:function(t,e,n){"use strict";var r=n("a23b"),a=n.n(r);a.a},c0bd:function(t,e,n){},e29d:function(t,e,n){}});
//# sourceMappingURL=app.384af34c.js.map